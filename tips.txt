Some Bugs while pwning with ROP: 

The MOVAPS issue:
If you're using Ubuntu 18.04 and segfaulting on a movaps instruction in buffered_vfprintf() or do_system() in the x86_64 challenges, then ensure the stack is 16-byte aligned 
before returning to GLIBC functions such as printf() or system(). The version of GLIBC packaged with Ubuntu 18.04 uses movaps instructions to move data onto the stack in some 
functions. The 64 bit calling convention requires the stack to be 16-byte aligned before a call instruction but this is easily violated during ROP chain execution, causing all 
further calls from that function to be made with a misaligned stack. movaps triggers a general protection fault when operating on unaligned data, so try padding your ROP chain 
with an extra ret before returning into a function or return further into a function to skip a push instruction. This bug only happens on ubuntu and ubuntu based operating sys's
like pop-os for example!!

Solution: 
Add more instructions to align your stack, an example would to be to add another ret pop_rdi = p64(addr) and whilst combining in your payload you can do: 
payload += p64(pop_rdi_ret addr+4)

This will align your stack! 

usr/bin/bash issues:
When debugging a ROP chain with GDB, if you've successfully called system() but the string you've passed is not a valid program, GDB will still tell you that it has started a new
process "/usr/bin/bash". This can be particularly confusing when you're trying to drop a shell. Check out the system() manpage for the reason behind this. 

Solution: 
There are more valid ways of finding not only the user/bin/bash string but also /bin/sh, you can search through libc with strings A.E "strings -a (all) -t x (will print the offset)
(libc version) | grep "usr/bin/bash" or "/bin/sh". " You can also use GDB plugins like GEF, Pwndbg and Peda$ (I will link them all) and using base gdb which has a handy command 
called "find" the command you'd want to use is "find /bin/sh or /usr/bin/bash all" make sure you start the program however, and just for safe measures step an instruction.  


Links: 
gef - https://github.com/hugsy/gef
peda - https://github.com/longld/peda
pwndbg - https://github.com/pwndbg/pwndbg
